language: php
php: 7.4
services:
  - docker
  - mysql
before_install:
  - composer install
  - sudo mysql -e 'CREATE DATABASE pyp_test;'
  - sudo mysql -e "use mysql; update user set authentication_string=PASSWORD('root') where User='root'; update user set plugin='mysql_native_password'; FLUSH PRIVILEGES;"
  - sudo mysql_upgrade -u root -proot
  - sudo service mysql restart
  - touch .env.local
  - echo "APP_ENV=test" > .env.local
  - php bin/console doctrine:migrations:migrate --no-interaction
script:
  - vendor/bin/phpunit